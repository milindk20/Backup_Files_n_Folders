<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Drive Backup</title>

<!-- Font Awesome Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
:root {
    --primary: #4f46e5;
    --primary-dark: #4338ca;
    --bg: #f5f7fb;
    --card: #ffffff;
    --text: #1f2937;
    --muted: #6b7280;
    --danger: #dc2626;
    --success: #22c55e;
}

* {
    box-sizing: border-box;
}

body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: var(--bg);
    padding: 30px;
    color: var(--text);
}

.container {
    max-width: 760px;
    margin: auto;
    background: var(--card);
    padding: 28px;
    border-radius: 14px;
    box-shadow: 0 10px 25px rgba(0,0,0,.08);
}

h1 {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
    font-size: 26px;
}

label {
    font-weight: 600;
    margin-top: 18px;
    display: block;
}

textarea,
input[type="text"] {
    width: 100%;
    padding: 12px;
    margin-top: 8px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    font-size: 14px;
    transition: border .2s, box-shadow .2s;
}

textarea:focus,
input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(79,70,229,.15);
}

.mode {
    margin-top: 22px;
}

.mode-option {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    cursor: pointer;
}

.mode-option input {
    accent-color: var(--primary);
}

.mode-option.mirror {
    border-color: #fecaca;
    background: #fef2f2;
}

.mode-option.mirror small {
    color: var(--danger);
}

button {
    margin-top: 26px;
    width: 100%;
    padding: 14px;
    font-size: 16px;
    font-weight: 600;
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background .2s, transform .1s;
}

button:hover {
    background: var(--primary-dark);
}

button:active {
    transform: scale(.98);
}

.progress {
    margin-top: 26px;
    height: 26px;
    background: #e5e7eb;
    border-radius: 999px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #22c55e, #4ade80);
    color: #fff;
    text-align: center;
    font-weight: 600;
    line-height: 26px;
    transition: width .5s ease;
}

.stats {
    margin-top: 14px;
    font-size: 14px;
    color: var(--muted);
}

.error {
    margin-top: 14px;
    color: var(--danger);
    font-weight: 600;
}
</style>
</head>
<body>

<div class="container">
<h1><i class="fa-solid fa-hard-drive"></i> Drive Backup</h1>

<label><i class="fa-solid fa-folder-open"></i> Source Directories</label>
<textarea id="sources" rows="4" placeholder="/home/user/Documents"></textarea>

<label><i class="fa-solid fa-folder-tree"></i> Destination Directory</label>
<input id="destination" type="text" placeholder="/mnt/backup">

<div class="mode">
<strong><i class="fa-solid fa-gear"></i> Backup Mode</strong>

<label class="mode-option">
<input type="radio" name="mode" value="incremental" checked>
<span>
<b>Incremental</b><br>
<small>Only copies new or changed files (safe)</small>
</span>
</label>

<label class="mode-option mirror">
<input type="radio" name="mode" value="mirror">
<span>
<b>Mirror</b><br>
<small>Deletes files removed from source</small>
</span>
</label>
</div>

<button onclick="startBackup()">
<i class="fa-solid fa-play"></i> Start Backup
</button>

<div class="progress">
<div class="progress-bar" id="progressBar">0%</div>
</div>

<div class="stats" id="stats"></div>
<div class="error" id="error"></div>
</div>

<script>
let timer;

function startBackup() {
    document.getElementById('error').textContent = '';
    updateBar(0);

    const sources = document.getElementById('sources')
        .value.split('\n').map(s => s.trim()).filter(Boolean);

    const destination = document.getElementById('destination').value.trim();

    const mirrorMode =
        document.querySelector('input[name="mode"]:checked').value === 'mirror';

    fetch('/start-backup', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            source_dirs: sources,
            destination: destination,
            mirror_mode: mirrorMode
        })
    })
    .then(r => r.json())
    .then(d => {
        if (d.status !== 'started') {
            document.getElementById('error').textContent = d.message;
            return;
        }
        timer = setInterval(fetchProgress, 1000);
    });
}

function fetchProgress() {
    fetch('/progress')
        .then(r => r.json())
        .then(p => {
            updateBar(p.percent || 0);
            document.getElementById('stats').textContent =
                `Status: ${p.status} | Copied: ${p.copied_files}/${p.total_files} | ` +
                `Removed: ${p.removed_files || 0} | Failed: ${p.failed_files} | ` +
                `ETA: ${p.eta !== null ? p.eta + 's' : '-'}`;

            if (p.status === 'done' || p.status === 'error') {
                clearInterval(timer);
            }
        });
}

function updateBar(p) {
    const bar = document.getElementById('progressBar');
    bar.style.width = p + '%';
    bar.textContent = p + '%';
}
</script>

</body>
</html>
